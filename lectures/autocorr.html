<!DOCTYPE html>
<html lang="en"><head>
<script src="autocorr_files/libs/clipboard/clipboard.min.js"></script>
<script src="autocorr_files/libs/quarto-html/tabby.min.js"></script>
<script src="autocorr_files/libs/quarto-html/popper.min.js"></script>
<script src="autocorr_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="autocorr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="autocorr_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="autocorr_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="autocorr_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <title>autocorr</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="autocorr_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="autocorr_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="autocorr_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="style.css">
  <link href="autocorr_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="autocorr_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="autocorr_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="autocorr_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section id="dealing-with-autocorrelation" class="title-slide slide level1 center">
<h1>Dealing with Autocorrelation</h1>

<img data-src="images/autocorr/why-are-plots.jpg" class="r-stretch"></section>

<section id="are-ecological-global-change-analyses-mostly-wrong" class="title-slide slide level1 center">
<h1>Are Ecological Global Change Analyses Mostly Wrong?</h1>

<img data-src="images/autocorr/johnson_et_al_2024_title.png" class="r-stretch"><p><a href="https://www.nature.com/articles/s41586-024-07236-z" class="small left">Johnson et al.&nbsp;2024</a></p>
</section>

<section id="are-ecological-global-change-analyses-mostly-wrong-1" class="title-slide slide level1 center">
<h1>Are Ecological Global Change Analyses Mostly Wrong?</h1>

<img data-src="images/autocorr/johnson_fig_2.png" class="r-stretch"><p><a href="https://www.nature.com/articles/s41586-024-07236-z" class="small left">Johnson et al.&nbsp;2024</a></p>
</section>

<section id="an-autocorrelated-adventure" class="title-slide slide level1 center">
<h1>An Autocorrelated Adventure</h1>
<ol type="1">
<li><p>Intro to Autocorrelation</p></li>
<li><p>Autocorrelation in Space with Gaussian Processes</p></li>
<li><p>Autocorrelation due to Phylogeny</p></li>
<li><p>Splines and Autocorrelation in Time</p></li>
</ol>
</section>

<section id="measurements-are-often-distributed-in-continuous-not-discrete-space" class="title-slide slide level1 center">
<h1>Measurements Are Often Distributed in Continuous, Not Discrete, Space</h1>

<img data-src="autocorr_files/figure-revealjs/plot_boreal_raw-1.jpeg" width="672" class="r-stretch"></section>

<section id="naive-model" class="title-slide slide level1 center">
<h1>Naive Model</h1>
<p>Wetness -&gt; NDVI</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a>boreal <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"./data/06/Boreality.txt"</span>, <span class="at">header=</span>T) <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">NDVI_s =</span> <span class="fu">standardize</span>(NDVI),</span>
<span id="cb1-3"><a href=""></a>         <span class="at">Wet_s =</span> <span class="fu">standardize</span>(Wet))</span>
<span id="cb1-4"><a href=""></a></span>
<span id="cb1-5"><a href=""></a></span>
<span id="cb1-6"><a href=""></a>ndvi_nospatial <span class="ot">&lt;-</span> <span class="fu">alist</span>(</span>
<span id="cb1-7"><a href=""></a>  NDVI_s <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb1-8"><a href=""></a>  mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> Wet_s,</span>
<span id="cb1-9"><a href=""></a>  alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1-10"><a href=""></a>  beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1-11"><a href=""></a>  sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">2</span>)</span>
<span id="cb1-12"><a href=""></a>)</span>
<span id="cb1-13"><a href=""></a></span>
<span id="cb1-14"><a href=""></a><span class="co"># fit</span></span>
<span id="cb1-15"><a href=""></a>ndvi_nospatial_fit <span class="ot">&lt;-</span> <span class="fu">quap</span>(ndvi_nospatial, boreal)</span>
<span id="cb1-16"><a href=""></a></span>
<span id="cb1-17"><a href=""></a><span class="co"># residuals</span></span>
<span id="cb1-18"><a href=""></a>boreal_fit <span class="ot">&lt;-</span> <span class="fu">linpred_draws</span>(ndvi_nospatial_fit, boreal, <span class="at">ndraws =</span> <span class="fl">1e3</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-19"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">.residuals =</span> NDVI_s <span class="sc">-</span> .value) <span class="sc">|&gt;</span></span>
<span id="cb1-20"><a href=""></a>  <span class="fu">group_by</span>(x, y, point) <span class="sc">|&gt;</span></span>
<span id="cb1-21"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">.residuals =</span> <span class="fu">mean</span>(.residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="spatial-autocorrelation-in-residuals" class="title-slide slide level1 center">
<h1>Spatial Autocorrelation in Residuals</h1>

<img data-src="autocorr_files/figure-revealjs/boreal_bad-1.jpeg" width="672" class="r-stretch"></section>

<section id="what-about-time" class="title-slide slide level1 center">
<h1>What About Time?</h1>

<img data-src="autocorr_files/figure-revealjs/oahu_tsplot-1.jpeg" width="672" class="r-stretch"></section>

<section id="autocorrelation-of-residuals-at-different-time-lags" class="title-slide slide level1 center">
<h1>Autocorrelation of Residuals at Different Time Lags</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-2-1.jpeg" width="672" class="r-stretch"></section>

<section id="phylogenetic-autocorrelation" class="title-slide slide level1 center">
<h1>Phylogenetic Autocorrelation</h1>

<img data-src="autocorr_files/figure-revealjs/phyloplot-1.jpeg" width="672" class="r-stretch"></section>

<section id="phylogenetically-correlated-residuals" class="title-slide slide level1 center">
<h1>Phylogenetically Correlated Residuals</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-3-1.jpeg" width="672" class="r-stretch"></section>

<section id="considering-correlation-consider-sampling-for-greeness" class="title-slide slide level1 center">
<h1>Considering Correlation: Consider sampling for greeness</h1>

<img data-src="autocorr_files/figure-revealjs/landscape-1.jpeg" width="960" class="r-stretch"></section>

<section id="modeling-greeness-with-a-random-intercept" class="title-slide slide level1 center">
<h1>Modeling Greeness with a Random Intercept</h1>
<p><strong>Likelihood</strong><br>
<span class="math inline">\(Green_i \sim Normal(\mu_{green}, \sigma_{green})\)</span></p>
<p><strong>Data Generating Process</strong><br>
<span class="math inline">\(\mu_{green} = \overline{a} + a_{patch}\)</span></p>
<p><span class="math inline">\(a_{patch} \sim dnorm(0, \sigma_{patch})\)</span></p>
<div class="fragment">
<center>
<font color="red">But “patch” isn’t discrete - it’s continuous, and we know how close they are to each other!</font>
</center>
</div>
</section>

<section id="we-think-in-terms-of-a-continuous-correlation-matrices-of-residuals" class="title-slide slide level1 center">
<h1>We Think in Terms of a Continuous Correlation Matrices of Residuals</h1>
<p><span class="math display">\[ \epsilon_{ij} = \rho \epsilon_{j} + \zeta_{i}\]</span></p>
<p>which produces</p>
<p><span class="math display">\[cor(\epsilon) = \begin{pmatrix}
1 &amp; \rho_{12} &amp;\rho_{13} \\
\rho_{12} &amp;  1&amp; \rho_{23}\\
\rho_{13} &amp; \rho_{23} &amp; 1
\end{pmatrix}\]</span></p>
</section>

<section id="for-a-mvn-we-use-the-covariance-matrix" class="title-slide slide level1 center">
<h1>For a MVN, We Use the Covariance Matrix</h1>
<p><span class="math display">\[K_{ij} = \begin{pmatrix}
\sigma_1^2 &amp; \sigma_1\sigma_2 &amp;\sigma_1\sigma_3 \\
\sigma_1\sigma_2 &amp;  \sigma_2^2&amp; \sigma_2\sigma_3\\
\sigma_1\sigma_3 &amp; \sigma_2\sigma_3 &amp; \sigma_3^2
\end{pmatrix}\]</span></p>
<p>But: what is the function that defines <span class="math inline">\(\sigma_i\sigma_j\)</span> based on the distance between i and j?</p>
</section>

<section id="different-shapes-of-autocorrelation" class="title-slide slide level1 center">
<h1>Different Shapes of Autocorrelation</h1>

<img data-src="./images/06/autocor_shape.jpg" class="r-stretch"></section>

<section id="introducing-gaussian-processes" class="title-slide slide level1 center">
<h1>Introducing Gaussian Processes</h1>
<p>A GP is a random process creating a multivariate normal distribution between points where the covariance between points is related to their distance.</p>
<p><span class="math display">\[a_{patch} \sim MVNorm(0, K)\]</span></p>
<span class="math display">\[K_{ij} = F(D_{ij})\]</span>
<center>
where <span class="math inline">\(D_{ij} = x_i - x_j\)</span>
</center>
</section>

<section id="the-squared-exponential-functionkernel" class="title-slide slide level1 center">
<h1>The Squared Exponential Function(kernel)</h1>
<p><span class="math display">\[K_{ij} = \eta^2 exp \left( -\frac{D_{ij}^2}{2 \mathcal{l}^2} \right)\]</span></p>
<p>where <span class="math inline">\(\eta^2\)</span> provides the scale of the function and <span class="math inline">\(\mathcal{l}\)</span> the timescale of the process</p>
</section>

<section id="the-squared-exponential-covariance-function-kernel" class="title-slide slide level1 center">
<h1>The Squared Exponential Covariance Function (kernel)</h1>

<img data-src="autocorr_files/figure-revealjs/show_l-1.jpeg" width="672" class="r-stretch"></section>

<section id="a-surface-from-a-squared-exponential-gp" class="title-slide slide level1 center">
<h1>A surface from a Squared Exponential GP</h1>

<img data-src="autocorr_files/figure-revealjs/landscape-1.jpeg" width="864" class="r-stretch"></section>

<section id="squared-exponential-v.-linear-dropoff" class="title-slide slide level1 center">
<h1>Squared Exponential v. Linear Dropoff</h1>

<img data-src="autocorr_files/figure-revealjs/show_cov_fun-1.jpeg" width="672" class="r-stretch"></section>

<section id="other-covariance-functions" class="title-slide slide level1 center">
<h1>Other Covariance Functions</h1>
<div>
<ul>
<li class="fragment"><p>Periodic: <span class="math inline">\(K_{P}(i,j) = \exp\left(-\frac{ 2\sin^2\left(\frac{D_{ij}}{2} \right)}{\mathcal{l}^2} \right)\)</span></p></li>
<li class="fragment"><p>Ornstein–Uhlenbeck: <span class="math inline">\(K_{OI}(i,j) = \eta^2 exp \left( -\frac{|D_{ij}|}{\mathcal{l}} \right)\)</span></p></li>
<li class="fragment"><p>Quadratic <span class="math inline">\(K_{RQ}(i,j)=(1+|d|^{2})^{-\alpha },\quad \alpha \geq 0\)</span></p></li>
<li class="fragment"><p>Note, all of the above can be folded into 1D or 3D, etc autocorrelation</p></li>
<li class="fragment"><p>AR1, AR2, etc., are just modifications of the above</p></li>
</ul>
</div>
</section>

<section id="the-squared-exponential-function-in-rethinking-with-cov_gpl2" class="title-slide slide level1 center">
<h1>The Squared Exponential Function in rethinking (with cov_GPL2)</h1>
<p><span class="math display">\[K_{ij} = \eta^2 exp \left( -\frac{D_{ij}^2}{2 \mathcal{l}^2} \right)\]</span><br>
Rethinking:<br>
<span class="math display">\[K_{ij} = \eta^2 exp \left( -\rho^2 D_{ij}^2 \right) + \delta_{ij}\sigma^2\]</span></p>
<li class="fragment">
<span class="math inline">\(\rho^2 = \frac{1}{2 \mathcal{l}^2}\)</span>
</li>
<li class="fragment">
<span class="math inline">\(\delta_{ij}\)</span> introduces extra covariance due to replicate measurements
</li>
</section>

<section id="operationalizing-a-gp" class="title-slide slide level1 center">
<h1>Operationalizing a GP</h1>
<p>Let’s assume a Squared Exponential GP with an <span class="math inline">\(\eta^2\)</span> and <span class="math inline">\(\mathcal{l}\)</span> of 1. Many possible curves:</p>

<img data-src="autocorr_files/figure-revealjs/possible-1.jpeg" width="672" class="r-stretch"></section>

<section id="operationalizing-a-gp-1" class="title-slide slide level1 center">
<h1>Operationalizing a GP</h1>
<p>And actually, on average</p>

<img data-src="autocorr_files/figure-revealjs/show_gp-1.jpeg" width="672" class="r-stretch"></section>

<section id="but-once-we-add-some-data" class="title-slide slide level1 center">
<h1>But once we add some data…</h1>
<p>Pinching in around observations!</p>

<img data-src="autocorr_files/figure-revealjs/show_gp_2-1.jpeg" width="672" class="r-stretch"></section>

<section id="warnings" class="title-slide slide level1 center">
<h1>Warnings!</h1>
<div>
<ol type="1">
<li class="fragment"><p>Not mechanistic!</p></li>
<li class="fragment"><p>But can incorporate many sources of variability</p>
<ul>
<li class="fragment">e.g., recent analysis showing multiple GP underlying Zika for forecasting</li>
</ul></li>
<li class="fragment"><p>Can mix mechanism and GP</p></li>
</ol>
</div>
</section>

<section id="an-autocorrelated-adventure-1" class="title-slide slide level1 center">
<h1>An Autocorrelated Adventure</h1>
<ol type="1">
<li><p>Intro to Autocorrelation</p></li>
<li><p><span class="red">Autocorrelation in Space with Gaussian Processes</span></p></li>
<li><p>Autocorrelation due to Phylogeny</p></li>
<li><p>Splines and Autocorrelation in Time</p></li>
</ol>
</section>

<section id="oceanic-tool-use" class="title-slide slide level1 center">
<h1>Oceanic Tool Use</h1>

<img data-src="./images/gp/tool_map.jpg" style="width:45.0%" class="r-stretch"><div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     culture population contact total_tools mean_TU   lat   lon  lon2   logpop
1   Malekula       1100     low          13     3.2 -16.3 167.5 -12.5 7.003065
2    Tikopia       1500     low          22     4.7 -12.3 168.8 -11.2 7.313220
3 Santa Cruz       3600     low          24     4.0 -10.7 166.0 -14.0 8.188689
4        Yap       4791    high          43     5.0   9.5 138.1 -41.9 8.474494
5   Lau Fiji       7400    high          33     5.0 -17.7 178.1  -1.9 8.909235
6  Trobriand       8000    high          19     4.0  -8.7 150.9 -29.1 8.987197</code></pre>
</div>
</div>
</section>

<section id="distances-between-islands" class="title-slide slide level1 center">
<h1>Distances between islands</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">data</span>(islandsDistMatrix)</span>
<span id="cb3-2"><a href=""></a>islandsDistMatrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Malekula Tikopia Santa Cruz   Yap Lau Fiji Trobriand Chuuk Manus
Malekula      0.000   0.475      0.631 4.363    1.234     2.036 3.178 2.794
Tikopia       0.475   0.000      0.315 4.173    1.236     2.007 2.877 2.670
Santa Cruz    0.631   0.315      0.000 3.859    1.550     1.708 2.588 2.356
Yap           4.363   4.173      3.859 0.000    5.391     2.462 1.555 1.616
Lau Fiji      1.234   1.236      1.550 5.391    0.000     3.219 4.027 3.906
Trobriand     2.036   2.007      1.708 2.462    3.219     0.000 1.801 0.850
Chuuk         3.178   2.877      2.588 1.555    4.027     1.801 0.000 1.213
Manus         2.794   2.670      2.356 1.616    3.906     0.850 1.213 0.000
Tonga         1.860   1.965      2.279 6.136    0.763     3.893 4.789 4.622
Hawaii        5.678   5.283      5.401 7.178    4.884     6.653 5.787 6.722
           Tonga Hawaii
Malekula   1.860  5.678
Tikopia    1.965  5.283
Santa Cruz 2.279  5.401
Yap        6.136  7.178
Lau Fiji   0.763  4.884
Trobriand  3.893  6.653
Chuuk      4.789  5.787
Manus      4.622  6.722
Tonga      0.000  5.037
Hawaii     5.037  0.000</code></pre>
</div>
</div>
</section>

<section id="what-if-i-needed-to-make-a-distance-matrix" class="title-slide slide level1 center">
<h1>What if I needed to make a distance matrix?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="fu">dist</span>(<span class="fu">cbind</span>(Kline2<span class="sc">$</span>lat, Kline2<span class="sc">$</span>lon))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            1          2          3          4          5          6          7
2    4.205948                                                                  
3    5.797413   3.224903                                                       
4   39.115214  37.652756  34.444884                                            
5   10.692053  10.754069  13.978913  48.371893                                 
6   18.257053  18.258423  15.231874  22.250393  28.650305                      
7   28.539446  26.152055  23.129418  13.662357  36.500137  16.115210           
8   25.019992  24.158849  20.946837  14.560220  34.882660   7.717513  10.599057
9  342.735029 344.115112 341.361524 314.800540 353.317336 326.339486 328.049082
10 325.121593 325.994172 323.052503 293.884076 335.811629 307.831464 307.454208
            8          9
2                       
3                       
4                       
5                       
6                       
7                       
8                       
9  322.665802           
10 303.298945  45.534273</code></pre>
</div>
</div>
<p>Well, convert lat/lon to UTM first, and to matrix after <code>dist</code></p>
</section>

<section id="our-gp-model" class="title-slide slide level1 center">
<h1>Our GP Model</h1>
<p><strong>Likelihood</strong><br>
<span class="math inline">\(Tools_i \sim Poisson(\lambda_i)\)</span></p>
<p><strong>Data Generating Process</strong> <span class="math inline">\(log(\lambda_i) = \alpha + \gamma_{society} + \beta log(Population_i)\)</span></p>
<div class="fragment">
<p><strong>Gaussian Process</strong> <span class="math inline">\(\gamma_{society} \sim MVNormal((0, ....,0), K)\)</span><br>
<span class="math inline">\(K_{ij} = \eta^2 exp \left( -\rho^2 D_{ij}^2 \right) + \delta_{ij}(0.01)\)</span></p>
</div>
<div class="fragment">
<p><strong>Priors</strong><br>
<span class="math inline">\(\alpha \sim Normal(0,10)\)</span><br>
<span class="math inline">\(\beta \sim Normal(0,1)\)</span><br>
<span class="math inline">\(\eta^2 \sim Exponential(2)\)</span><br>
<span class="math inline">\(\rho^2 \sim Exponential(0.5)\)</span></p>
</div>
</section>

<section id="our-model" class="title-slide slide level1 center">
<h1>Our model</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a>Kline2<span class="sc">$</span>society <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Kline2)</span>
<span id="cb7-2"><a href=""></a></span>
<span id="cb7-3"><a href=""></a>k2mod <span class="ot">&lt;-</span>   <span class="fu">alist</span>(</span>
<span id="cb7-4"><a href=""></a>  <span class="co"># likelihood</span></span>
<span id="cb7-5"><a href=""></a>  total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb7-6"><a href=""></a>  </span>
<span id="cb7-7"><a href=""></a>  <span class="co"># Data Generating Process</span></span>
<span id="cb7-8"><a href=""></a>  <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> a <span class="sc">+</span> k[society] <span class="sc">+</span> bp<span class="sc">*</span>logpop,</span>
<span id="cb7-9"><a href=""></a></span>
<span id="cb7-10"><a href=""></a>  <span class="co"># Gaussian Process</span></span>
<span id="cb7-11"><a href=""></a>  vector[<span class="dv">10</span>]<span class="sc">:</span>k <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="dv">0</span> , SIGMA ),</span>
<span id="cb7-12"><a href=""></a>  matrix[<span class="dv">10</span>,<span class="dv">10</span>]<span class="sc">:</span>SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL2</span>( Dmat , etasq , rhosq , <span class="fl">0.01</span> ),</span>
<span id="cb7-13"><a href=""></a>  </span>
<span id="cb7-14"><a href=""></a>  <span class="co"># Priors</span></span>
<span id="cb7-15"><a href=""></a>  a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb7-16"><a href=""></a>  bp <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb7-17"><a href=""></a>  etasq <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">2</span>),</span>
<span id="cb7-18"><a href=""></a>  rhosq <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.5</span>)</span>
<span id="cb7-19"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="gpl2" class="title-slide slide level1 center">
<h1>GPL2</h1>
<center>
<code>g[society] ~ cov_GPL2( Dmat , etasq , rhosq , 0.01)</code>
</center>
<ul>
<li><p>Note that we supply a distance matrix</p></li>
<li><p><code>cov_GPL2</code> explicitly creates the MV Normal density, but only requires parameters</p></li>
</ul>
</section>

<section id="fitting---a-list-shall-lead-them" class="title-slide slide level1 center">
<h1>Fitting - a list shall lead them</h1>
<ul>
<li>We have data of various classes (e.g.&nbsp;matrix, vectors)<br>
</li>
<li>Hence, we use a list<br>
</li>
<li>This can be generalized to many cases, e.g.&nbsp;true multilevel models</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>k2fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(k2mod,</span>
<span id="cb8-2"><a href=""></a> <span class="at">data =</span> <span class="fu">list</span>(</span>
<span id="cb8-3"><a href=""></a>    <span class="at">total_tools =</span> Kline2<span class="sc">$</span>total_tools,</span>
<span id="cb8-4"><a href=""></a>    <span class="at">logpop =</span> Kline2<span class="sc">$</span>logpop,</span>
<span id="cb8-5"><a href=""></a>    <span class="at">society =</span> Kline2<span class="sc">$</span>society,</span>
<span id="cb8-6"><a href=""></a>    <span class="at">Dmat =</span> islandsDistMatrix),</span>
<span id="cb8-7"><a href=""></a> <span class="at">chains=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="did-it-converge" class="title-slide slide level1 center">
<h1>Did it converge?</h1>

<img data-src="autocorr_files/figure-revealjs/converge_k2-1.jpeg" width="672" class="r-stretch"></section>

<section id="did-it-fit" class="title-slide slide level1 center">
<h1>Did it fit?</h1>

<img data-src="autocorr_files/figure-revealjs/postcheck_k2-1.jpeg" width="672" class="r-stretch"></section>

<section id="what-does-it-all-mean" class="title-slide slide level1 center">
<h1>What does it all mean?</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>           mean         sd        5.5%     94.5%     rhat ess_bulk
a     1.2683090 0.96101153 -0.18077277 2.8894966 1.014524 325.8624
bp    0.2486083 0.09600888  0.09306479 0.3967548 1.011408 410.5729
etasq 0.2039891 0.22047529  0.02702730 0.6232529 1.014706 261.0889
rhosq 1.3945047 1.65297194  0.07653043 4.7089869 1.012138 406.8024</code></pre>
</div>
</div>
</section>

<section id="what-is-our-covariance-function-by-distance" class="title-slide slide level1 center">
<h1>What is our covariance function by distance?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="co">#get samples</span></span>
<span id="cb10-2"><a href=""></a>k2_samp <span class="ot">&lt;-</span> <span class="fu">tidy_draws</span>(k2fit) </span>
<span id="cb10-3"><a href=""></a></span>
<span id="cb10-4"><a href=""></a><span class="co">#covariance function</span></span>
<span id="cb10-5"><a href=""></a>cov_fun_rethink <span class="ot">&lt;-</span> <span class="cf">function</span>(d, etasq, rhosq){</span>
<span id="cb10-6"><a href=""></a>  etasq <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span>rhosq <span class="sc">*</span> d<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-7"><a href=""></a>}</span>
<span id="cb10-8"><a href=""></a></span>
<span id="cb10-9"><a href=""></a><span class="co">#make curves</span></span>
<span id="cb10-10"><a href=""></a>decline_df <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="at">length.out=</span><span class="dv">200</span>)), </span>
<span id="cb10-11"><a href=""></a>                       <span class="fu">data.frame</span>(<span class="at">etasq =</span> k2_samp<span class="sc">$</span>etasq[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>],</span>
<span id="cb10-12"><a href=""></a>                                  <span class="at">rhosq =</span> k2_samp<span class="sc">$</span>rhosq[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href=""></a> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">covariance =</span> <span class="fu">cov_fun_rethink</span>(x, etasq, rhosq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="covariance-by-distance" class="title-slide slide level1 center">
<h1>Covariance by distance</h1>

<img data-src="autocorr_files/figure-revealjs/plot_cov_dist-1.jpeg" width="672" class="r-stretch"></section>

<section id="correlation-matrix" class="title-slide slide level1 center">
<h1>Correlation Matrix</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>cov_mat <span class="ot">&lt;-</span> <span class="fu">cov_fun_rethink</span>(islandsDistMatrix,</span>
<span id="cb11-2"><a href=""></a>                           <span class="fu">median</span>(k2_samp<span class="sc">$</span>etasq),</span>
<span id="cb11-3"><a href=""></a>                           <span class="fu">median</span>(k2_samp<span class="sc">$</span>rhosq))</span>
<span id="cb11-4"><a href=""></a></span>
<span id="cb11-5"><a href=""></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cov2cor</span>(cov_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="putting-it-all-together" class="title-slide slide level1 center">
<h1>Putting it all together…</h1>

<img data-src="autocorr_files/figure-revealjs/plot_res-1.jpeg" width="672" class="r-stretch"></section>

<section id="putting-it-all-together-1" class="title-slide slide level1 center">
<h1>Putting it all together…</h1>

<img data-src="autocorr_files/figure-revealjs/show_sims-1.jpeg" width="672" class="r-stretch"></section>

<section id="an-autocorrelated-adventure-2" class="title-slide slide level1 center">
<h1>An Autocorrelated Adventure</h1>
<ol type="1">
<li><p>Intro to Autocorrelation</p></li>
<li><p>Autocorrelation in Space with Gaussian Processes</p></li>
<li><p><span class="red">Autocorrelation due to Phylogeny</span></p></li>
<li><p>Splines and Autocorrelation in Time</p></li>
</ol>
</section>

<section id="what-about-phylogenetic-autocorrelation" class="title-slide slide level1 center">
<h1>What About Phylogenetic Autocorrelation?</h1>

<img data-src="autocorr_files/figure-revealjs/phyloplot-1.jpeg" width="672" class="r-stretch"></section>

<section id="does-primate-group-size-select-for-brain-size" class="title-slide slide level1 center">
<h1>Does Primate Group Size Select for Brain Size?</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-4-1.jpeg" width="672" class="r-stretch"></section>

<section id="possibilities-for-incorporating-relatedness" class="title-slide slide level1 center">
<h1>Possibilities for Incorporating Relatedness</h1>
<p><span class="math display">\[group \ size \sim MVN(\mu, \Sigma)\\
\mu_i = \alpha + \beta_G G_i + \beta_M M_i\]</span></p>
<div>
<ul>
<li class="fragment"><p>Nothing: <span class="math inline">\(\Sigma = \sigma^2 I\)</span></p></li>
<li class="fragment"><p>Linear/Brownian: <span class="math inline">\(\Sigma_{ij} = \rho_{ij} \sigma^2\)</span></p></li>
<li class="fragment"><p>OU/Linear GP: <span class="math inline">\(K_{ij} = \eta^2 exp \left( -\rho^2 D_{ij} \right)\)</span></p></li>
</ul>
</div>
</section>

<section id="data-prep" class="title-slide slide level1 center">
<h1>Data Prep</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">data</span>(Primates301)</span>
<span id="cb12-2"><a href=""></a></span>
<span id="cb12-3"><a href=""></a>dstan <span class="ot">&lt;-</span> Primates301 <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href=""></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(group_size),</span>
<span id="cb12-6"><a href=""></a>         <span class="sc">!</span><span class="fu">is.na</span>(body),</span>
<span id="cb12-7"><a href=""></a>         <span class="sc">!</span><span class="fu">is.na</span>(brain)</span>
<span id="cb12-8"><a href=""></a>         )</span>
<span id="cb12-9"><a href=""></a></span>
<span id="cb12-10"><a href=""></a><span class="co"># for matrices</span></span>
<span id="cb12-11"><a href=""></a>spp_obs <span class="ot">&lt;-</span> dstan<span class="sc">$</span>name</span>
<span id="cb12-12"><a href=""></a></span>
<span id="cb12-13"><a href=""></a><span class="co"># A list of data and an Identity Matrix</span></span>
<span id="cb12-14"><a href=""></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb12-15"><a href=""></a>    <span class="at">N_spp =</span> <span class="fu">nrow</span>(dstan),</span>
<span id="cb12-16"><a href=""></a>    <span class="at">M =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(dstan<span class="sc">$</span>body)),</span>
<span id="cb12-17"><a href=""></a>    <span class="at">B =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(dstan<span class="sc">$</span>brain)),</span>
<span id="cb12-18"><a href=""></a>    <span class="at">G =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(dstan<span class="sc">$</span>group_size)),</span>
<span id="cb12-19"><a href=""></a>    <span class="at">Imat =</span> <span class="fu">diag</span>(<span class="fu">nrow</span>(dstan)) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="no-correlation" class="title-slide slide level1 center">
<h1>No Correlation</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>no_phylo <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb13-2"><a href=""></a>    <span class="fu">alist</span>(</span>
<span id="cb13-3"><a href=""></a>        <span class="co">#likelihood</span></span>
<span id="cb13-4"><a href=""></a>        B <span class="sc">~</span> <span class="fu">multi_normal</span>( mu , SIGMA ),</span>
<span id="cb13-5"><a href=""></a>        </span>
<span id="cb13-6"><a href=""></a>        <span class="co"># DGP</span></span>
<span id="cb13-7"><a href=""></a>        mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM<span class="sc">*</span>M <span class="sc">+</span> bG<span class="sc">*</span>G,</span>
<span id="cb13-8"><a href=""></a>        </span>
<span id="cb13-9"><a href=""></a>        <span class="co"># Autocorr</span></span>
<span id="cb13-10"><a href=""></a>        matrix[N_spp,N_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> Imat <span class="sc">*</span> sigma_sq,</span>
<span id="cb13-11"><a href=""></a>        </span>
<span id="cb13-12"><a href=""></a>        <span class="co">#priors</span></span>
<span id="cb13-13"><a href=""></a>        a <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="dv">1</span> ),</span>
<span id="cb13-14"><a href=""></a>        <span class="fu">c</span>(bM,bG) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb13-15"><a href=""></a>        sigma_sq <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> )</span>
<span id="cb13-16"><a href=""></a>    ), <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="making-a-correlation-distance-matrix" class="title-slide slide level1 center">
<h1>Making a Correlation Distance Matrix</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="fu">library</span>(ape)</span>
<span id="cb14-2"><a href=""></a></span>
<span id="cb14-3"><a href=""></a><span class="co">#make phylo cov/distance matrices</span></span>
<span id="cb14-4"><a href=""></a>tree_trimmed <span class="ot">&lt;-</span> <span class="fu">keep.tip</span>( Primates301_nex, spp_obs )</span>
<span id="cb14-5"><a href=""></a>Rbm <span class="ot">&lt;-</span> <span class="fu">corBrownian</span>( <span class="at">phy=</span>tree_trimmed )</span>
<span id="cb14-6"><a href=""></a>V <span class="ot">&lt;-</span> <span class="fu">vcv</span>(Rbm)</span>
<span id="cb14-7"><a href=""></a>Dmat <span class="ot">&lt;-</span> <span class="fu">cophenetic</span>( tree_trimmed )</span>
<span id="cb14-8"><a href=""></a></span>
<span id="cb14-9"><a href=""></a><span class="co"># put species in right order</span></span>
<span id="cb14-10"><a href=""></a>dat_list<span class="sc">$</span>V <span class="ot">&lt;-</span> V[ spp_obs , spp_obs ]</span>
<span id="cb14-11"><a href=""></a></span>
<span id="cb14-12"><a href=""></a><span class="co"># convert to correlation matrix</span></span>
<span id="cb14-13"><a href=""></a>dat_list<span class="sc">$</span>R <span class="ot">&lt;-</span> dat_list<span class="sc">$</span>V <span class="sc">/</span> <span class="fu">max</span>(V)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="the-correlation-matrix" class="title-slide slide level1 center">
<h1>The Correlation Matrix</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-9-1.jpeg" width="672" class="r-stretch"></section>

<section id="brownian-correlation" class="title-slide slide level1 center">
<h1>Brownian Correlation</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a>brownian <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb15-2"><a href=""></a>    <span class="fu">alist</span>(</span>
<span id="cb15-3"><a href=""></a>        <span class="co">#likelihood</span></span>
<span id="cb15-4"><a href=""></a>        B <span class="sc">~</span> <span class="fu">multi_normal</span>( mu , SIGMA ),</span>
<span id="cb15-5"><a href=""></a>        </span>
<span id="cb15-6"><a href=""></a>        <span class="co"># DGP</span></span>
<span id="cb15-7"><a href=""></a>        mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM<span class="sc">*</span>M <span class="sc">+</span> bG<span class="sc">*</span>G,</span>
<span id="cb15-8"><a href=""></a>        </span>
<span id="cb15-9"><a href=""></a>        <span class="co"># Autocorr</span></span>
<span id="cb15-10"><a href=""></a>        matrix[N_spp,N_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> R <span class="sc">*</span> sigma_sq,</span>
<span id="cb15-11"><a href=""></a>        </span>
<span id="cb15-12"><a href=""></a>        <span class="co">#priors</span></span>
<span id="cb15-13"><a href=""></a>         a <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="dv">1</span> ),</span>
<span id="cb15-14"><a href=""></a>        <span class="fu">c</span>(bM,bG) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb15-15"><a href=""></a>        sigma_sq <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> )</span>
<span id="cb15-16"><a href=""></a>    ), <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span>, <span class="at">log_lik =</span> <span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="oulinear-gp-correlation" class="title-slide slide level1 center">
<h1>OU/Linear GP Correlation</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="co"># add scaled and reordered distance matrix</span></span>
<span id="cb16-2"><a href=""></a>dat_list<span class="sc">$</span>Dmat <span class="ot">&lt;-</span> Dmat[ spp_obs , spp_obs ] <span class="sc">/</span> <span class="fu">max</span>(Dmat)</span>
<span id="cb16-3"><a href=""></a></span>
<span id="cb16-4"><a href=""></a>ou_gp_mod <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb16-5"><a href=""></a>    <span class="fu">alist</span>(</span>
<span id="cb16-6"><a href=""></a>        <span class="co">#likelihood</span></span>
<span id="cb16-7"><a href=""></a>        B <span class="sc">~</span> <span class="fu">multi_normal</span>( mu , SIGMA ),</span>
<span id="cb16-8"><a href=""></a>        </span>
<span id="cb16-9"><a href=""></a>        <span class="co"># DGP</span></span>
<span id="cb16-10"><a href=""></a>        mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM<span class="sc">*</span>M <span class="sc">+</span> bG<span class="sc">*</span>G,</span>
<span id="cb16-11"><a href=""></a>        </span>
<span id="cb16-12"><a href=""></a>        <span class="co"># Autocorr</span></span>
<span id="cb16-13"><a href=""></a>        matrix[N_spp,N_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL1</span>( Dmat , etasq , rhosq , <span class="fl">0.01</span> ),        </span>
<span id="cb16-14"><a href=""></a>        <span class="co">#priors</span></span>
<span id="cb16-15"><a href=""></a>        a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb16-16"><a href=""></a>        <span class="fu">c</span>(bM,bG) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb16-17"><a href=""></a>        etasq <span class="sc">~</span> <span class="fu">half_normal</span>(<span class="dv">1</span>,<span class="fl">0.25</span>),</span>
<span id="cb16-18"><a href=""></a>        rhosq <span class="sc">~</span> <span class="fu">half_normal</span>(<span class="dv">3</span>,<span class="fl">0.25</span>)</span>
<span id="cb16-19"><a href=""></a>        </span>
<span id="cb16-20"><a href=""></a>    ), <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span>, <span class="at">log_lik =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="which-model-fits-best" class="title-slide slide level1 center">
<h1>Which Model Fits Best?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="co">#compare(no_phylo, brownian, ou_gp_mod, func = PSIS)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NOTE: Does not currently work due to working with matrices. Standby!</p>
</section>

<section id="comparing-g" class="title-slide slide level1 center">
<h1>Comparing G</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                   mean         sd         5.5%      94.5%     rhat  ess_bulk
no_phylo bG  0.12256875 0.02265879  0.085101822 0.15983441 1.000883 1195.5750
brownian bG  0.02405600 0.02026626 -0.008841488 0.05663509 1.035008  110.6589
ou_gp_mod bG 0.04975294 0.02311785  0.012833085 0.08657639 1.001296 2345.3181</code></pre>
</div>
</div>
</section>

<section id="an-autocorrelated-adventure-3" class="title-slide slide level1 center">
<h1>An Autocorrelated Adventure</h1>
<ol type="1">
<li><p>Intro to Autocorrelation</p></li>
<li><p>Autocorrelation in Space with Gaussian Processes</p></li>
<li><p>Autocorrelation due to Phylogeny</p></li>
<li><p><span class="red">Splines and Autocorrelation in Time</span></p></li>
</ol>
</section>

<section id="kelp-from-spaaaace" class="title-slide slide level1 center">
<h1>Kelp from spaaaace!!!</h1>

<img data-src="./images/gp/kelp_landsat.jpg" class="r-stretch"><p>Cavanaugh et al.&nbsp;2011, Bell et al.&nbsp;2015</p>
</section>

<section id="the-mohawk-transect-3-300m-timeseries" class="title-slide slide level1 center">
<h1>The Mohawk Transect 3 300m Timeseries</h1>

<img data-src="autocorr_files/figure-revealjs/ltrmk_plot-1.jpeg" width="672" class="r-stretch"></section>

<section id="polynomials-only-go-so-far" class="title-slide slide level1 center">
<h1>Polynomials Only Go So Far</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-13-1.jpeg" width="672" class="r-stretch"></section>

<section id="we-can-use-gaussian-processes" class="title-slide slide level1 center">
<h1>We Can Use Gaussian Processes…</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-14-1.jpeg" width="672" class="r-stretch"></section>

<section id="a-gaussian-process-is-a-general-case-of-a-spline-in-a-generalized-additive-model" class="title-slide slide level1 center">
<h1>A Gaussian Process is a General Case of a Spline in a Generalized Additive Model</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-15-1.jpeg" width="672" class="r-stretch"><div class="fragment">
<p>A Spline with many knots converges to a Gaussian Process</p>
</div>
</section>

<section id="how-do-we-make-a-spline-start" class="title-slide slide level1 center">
<h1>How do we Make a Spline: Start</h1>
<p>We start with a synthetic variable evenly along the X-axis spread using “knots”</p>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-16-1.jpeg" width="672" class="r-stretch"></section>

<section id="how-do-we-make-a-spline-weighting" class="title-slide slide level1 center">
<h1>How do we Make a Spline: Weighting</h1>

<img data-src="autocorr_files/figure-revealjs/weight_plot-1.jpeg" width="672" class="r-stretch"></section>

<section id="how-do-we-make-a-spline-sum-weighted-basis-set" class="title-slide slide level1 center">
<h1>How do we Make a Spline: Sum Weighted Basis Set</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-18-1.jpeg" width="672" class="r-stretch"></section>

<section id="predictions-from-spline" class="title-slide slide level1 center">
<h1>Predictions from Spline</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-19-1.jpeg" width="672" class="r-stretch"></section>

<section id="b-splines-with-different-knots" class="title-slide slide level1 center">
<h1>B-Splines with Different Knots</h1>

<img data-src="autocorr_files/figure-revealjs/splines_knots-1.jpeg" width="672" class="r-stretch"></section>

<section id="b-splines-of-different-degrees-to-control-wiggliness" class="title-slide slide level1 center">
<h1>B-Splines of Different Degrees to Control “Wiggliness”</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-20-1.jpeg" width="672" class="r-stretch"></section>

<section id="splines-basis-sets-of-different-types" class="title-slide slide level1 center">
<h1>Splines Basis Sets of Different Types</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-21-1.jpeg" width="672" class="r-stretch"><p>And More…</p>
</section>

<section id="the-gam-formulation-as-a-model" class="title-slide slide level1 center">
<h1>The GAM Formulation as a Model</h1>
<p><strong>Likelihood:</strong> <span class="math display">\[y_i\sim \mathcal{N}(\mu_i, \sigma^{2})\]</span></p>
<p><strong>Data Generating Process:</strong><br>
<span class="math display">\[g(\mu_i) = f(x_i)\]</span></p>
<p><span class="math display">\[ f(x_i) = \sum_{j=1}^{d}\gamma_jB_j(x_i)\]</span></p>
<div class="fragment">
<ul>
<li><p><span class="math inline">\(B_j(x)\)</span> is your basis function with <span class="math inline">\(d\)</span> elements.</p></li>
<li><p><span class="math inline">\(\gamma_j\)</span> is a weight for each element of the basis set.</p></li>
<li><p>You can have other linear predictors</p></li>
</ul>
</div>
</section>

<section id="the-cental-idea-behind-gams" class="title-slide slide level1 center">
<h1>The Cental Idea Behind GAMs</h1>

<img data-src="./images/gams/fig1_ultithread_stitchfix.svg" class="r-stretch"></section>

<section id="basis-functions-youve-seen-them-before" class="title-slide slide level1 center">
<h1>Basis Functions: You’ve seen them before</h1>
<p><span class="math display">\[f(X) = \sum_{j=1}^{d}\gamma_jB_j(x)\]</span></p>
<p>Linear Regression as a Basis Function:<br>
<span class="math display">\[d = 1\]</span></p>
<p><span class="math display">\[B_j(x) = x\]</span></p>
<div class="fragment">
<p>So…. <span class="math display">\[f(x) = \gamma_j x\]</span></p>
</div>
</section>

<section id="basis-functions-youve-seen-them-before-1" class="title-slide slide level1 center">
<h1>Basis Functions: You’ve seen them before</h1>
<p><span class="math display">\[f(X) = \sum_{j=1}^{d}\gamma_jB_j(x)\]</span></p>
<p>Polynomial Regression as a Basis Function:<br>
<span class="math display">\[f(x) = \gamma_0 + \gamma_1\cdot x^1 \ldots +\gamma_d\cdot x^d\]</span></p>
</section>

<section id="basis-functions-in-gams" class="title-slide slide level1 center">
<h1>Basis Functions in GAMs</h1>
<ul>
<li><p>You can think of every <span class="math inline">\(B_j(x)\)</span> as a transformation of x</p></li>
<li><p>In GAMs, we base j off of K knots</p></li>
<li><p>A knot is a place where we split our data into pieces</p>
<ul>
<li>We optimize knot choice, but let’s just split evenly for a demo</li>
</ul></li>
<li><p>For each segment of the data, we fit a seprate function, then add them together</p></li>
</ul>
</section>

<section id="a-model-for-the-z-transformed-kelp-time-series" class="title-slide slide level1 center">
<h1>A Model for the Z-Transformed Kelp Time Series</h1>
<p><strong>Likelihood:</strong> <span class="math display">\[Kelp\:Std_i \sim \mathcal{N}(\mu_i, \sigma)\]</span></p>
<div class="fragment">
<ul>
<li>We Z-Transform for ease of fit and to not worry about 0 problem</li>
</ul>
</div>
<div class="fragment">
<p><strong>Data Generating Process:</strong> <span class="math display">\[\mu_i = \alpha + \sum_{d=1}^D w_d B_{d,i}\]</span></p>
<ul>
<li>Here, remember, B is a transform of Date</li>
</ul>
</div>
<p><strong>Priors:</strong> <span class="math display">\[\alpha \sim \mathcal{N}(0, 2) \\
w_d \sim \mathcal{N}(0, 1) \\
\sigma \sim \mathcal{Exp}(1)\]</span></p>
</section>

<section id="building-the-basis-set-with-30-knots" class="title-slide slide level1 center">
<h1>Building the Basis Set with 30 knots</h1>
<div class="cell" data-source-line-numbers="|1-3|5-6|8-12|">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="co"># filter NA as it causes problems with matrix multiplication</span></span>
<span id="cb19-2"><a href=""></a>d <span class="ot">&lt;-</span> ltrmk3 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(X300m))</span>
<span id="cb19-3"><a href=""></a>d<span class="sc">$</span>k_s <span class="ot">&lt;-</span> <span class="fu">scale</span>(d<span class="sc">$</span>X300m)</span>
<span id="cb19-4"><a href=""></a></span>
<span id="cb19-5"><a href=""></a><span class="co"># make a knot list based on date with 30 knots</span></span>
<span id="cb19-6"><a href=""></a>knot_list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(d<span class="sc">$</span>Date), <span class="fu">max</span>(d<span class="sc">$</span>Date), <span class="at">length.out=</span><span class="dv">30</span>) </span>
<span id="cb19-7"><a href=""></a></span>
<span id="cb19-8"><a href=""></a><span class="co"># build the basis set</span></span>
<span id="cb19-9"><a href=""></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(d<span class="sc">$</span>Date,</span>
<span id="cb19-10"><a href=""></a>    <span class="at">knots=</span>knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,num_knots)], </span>
<span id="cb19-11"><a href=""></a>    <span class="at">degree=</span><span class="dv">1</span>, </span>
<span id="cb19-12"><a href=""></a>    <span class="at">intercept=</span><span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="the-model-in-rethinking" class="title-slide slide level1 center">
<h1>The Model in Rethinking</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="|5-6|12-17|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a>kelp_spline_mod <span class="ot">&lt;-</span> <span class="fu">alist</span>(</span>
<span id="cb20-2"><a href=""></a>  <span class="co"># Likelihood</span></span>
<span id="cb20-3"><a href=""></a>  K <span class="sc">~</span> <span class="fu">dnorm</span>(mu , sigma),</span>
<span id="cb20-4"><a href=""></a>  </span>
<span id="cb20-5"><a href=""></a>  <span class="co"># DGP</span></span>
<span id="cb20-6"><a href=""></a>  mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w,</span>
<span id="cb20-7"><a href=""></a>  </span>
<span id="cb20-8"><a href=""></a>  <span class="co"># Priors</span></span>
<span id="cb20-9"><a href=""></a>  a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb20-10"><a href=""></a>  w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb20-11"><a href=""></a>  sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb20-12"><a href=""></a>)</span>
<span id="cb20-13"><a href=""></a></span>
<span id="cb20-14"><a href=""></a><span class="co"># Fit with start values to give dimensions</span></span>
<span id="cb20-15"><a href=""></a><span class="co"># and a list to contain different data types</span></span>
<span id="cb20-16"><a href=""></a>kelp_spline_fit <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb20-17"><a href=""></a>  kelp_spline_mod,</span>
<span id="cb20-18"><a href=""></a>  <span class="at">data=</span><span class="fu">list</span>( <span class="at">K=</span>d<span class="sc">$</span>k_s , <span class="at">B=</span>B) ,</span>
<span id="cb20-19"><a href=""></a>  <span class="at">start=</span><span class="fu">list</span>( <span class="at">w=</span><span class="fu">rep</span>( <span class="dv">0</span> , <span class="fu">ncol</span>(B) ) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="what-did-it-all-mean" class="title-slide slide level1 center">
<h1>What did it all mean?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="|3|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a>kelp_pred <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a href=""></a>  <span class="fu">linpred_draws</span>(kelp_spline_fit, </span>
<span id="cb21-3"><a href=""></a>                <span class="at">newdata =</span> <span class="fu">list</span>( <span class="at">K=</span>d<span class="sc">$</span>k_s , <span class="at">B=</span>B , <span class="at">Date =</span> d<span class="sc">$</span>Date)) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href=""></a>  <span class="fu">group_by</span>(Date) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">k_s =</span> <span class="fu">mean</span>(.value),</span>
<span id="cb21-6"><a href=""></a>            <span class="at">X300m =</span> k_s <span class="sc">*</span> <span class="fu">sd</span>(d<span class="sc">$</span>X300m) <span class="sc">+</span> <span class="fu">mean</span>(<span class="fu">sd</span>(d<span class="sc">$</span>X300m)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="what-did-it-all-mean-1" class="title-slide slide level1 center">
<h1>What did it all mean?</h1>

<img data-src="autocorr_files/figure-revealjs/unnamed-chunk-24-1.jpeg" width="672" class="r-stretch"></section>

<section id="space-time-and-all-of-that" class="title-slide slide level1 center">
<h1>Space, Time, And All of That</h1>
<div>
<ul>
<li class="fragment"><p>Fundamentally, we assume things close to each other are more similar than things that are far apart.</p></li>
<li class="fragment"><p>If our predictors account for all variation, this <em>might</em> not be necessary.</p></li>
<li class="fragment"><p>But, if we wish to account for other correlated drivers or autocorrelation in residuals, we have many options</p></li>
<li class="fragment"><p>We can model K, the variance-covariance matrix with a MVN process.</p></li>
<li class="fragment"><p>We can use a spline (computationally faster) that will approximate a Gaussian Process</p></li>
</ul>
</div>
</section>

<section id="section" class="title-slide slide level1 center">
<h1></h1>

<img data-src="./images/gams/gam_gam_style.jpg" class="r-stretch"><div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="autocorr_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="autocorr_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="autocorr_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="autocorr_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>